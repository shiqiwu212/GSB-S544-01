<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Intro</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="PA_wrangle_Shiqi_Wu_files/libs/clipboard/clipboard.min.js"></script>
<script src="PA_wrangle_Shiqi_Wu_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="PA_wrangle_Shiqi_Wu_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="PA_wrangle_Shiqi_Wu_files/libs/quarto-html/popper.min.js"></script>
<script src="PA_wrangle_Shiqi_Wu_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="PA_wrangle_Shiqi_Wu_files/libs/quarto-html/anchor.min.js"></script>
<link href="PA_wrangle_Shiqi_Wu_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PA_wrangle_Shiqi_Wu_files/libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="PA_wrangle_Shiqi_Wu_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="PA_wrangle_Shiqi_Wu_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="PA_wrangle_Shiqi_Wu_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this PA, you will practice altering data frame objects in order to solve a riddle.</p>
<section id="repository" class="level3">
<h3 class="anchored" data-anchor-id="repository">Repository</h3>
<ul>
<li>GitHub (Code &amp; HTML): <a href="https://github.com/shiqiwu212/GSB-S54401/tree/28204b017d7238c67eebdb484b92e46884499fea/Week%202">Week 2 folder</a></li>
</ul>
</section>
<section id="advice-for-troubleshooting-your-code" class="level3">
<h3 class="anchored" data-anchor-id="advice-for-troubleshooting-your-code">Advice for troubleshooting your code</h3>
<section id="check-results-often" class="level4">
<h4 class="anchored" data-anchor-id="check-results-often">Check results often</h4>
<p>If a chunk of code runs smoothly without giving you any error or warnings this does not necessarily mean it accomplished the desired task.</p>
<p>It is a good habit to check the results of your code every time you finish a task.</p>
<p>If you created or updated a data frame, make sure your edits did what you hoped. Use the <em>Environment</em> or the <code>head()</code> function to investigate your changes.</p>
</section>
<section id="document-your-work" class="level4">
<h4 class="anchored" data-anchor-id="document-your-work">Document your work</h4>
<p>In the text before the code chunk, make sure to briefly state what the point of the chunk is. This will remind later readers - which might be your future self! - what the desired output is.</p>
<p>Use comments in the code to give quick explanations of the goals of complex steps.</p>
</section>
<section id="two-heads-are-better-than-one" class="level4">
<h4 class="anchored" data-anchor-id="two-heads-are-better-than-one">Two heads are better than one</h4>
<p>It can be hard to spot bugs in code that you yourself wrote.t (Have you ever sent a text message and not spotted an obvious typo? Same idea!)</p>
<p>Work with people around you if you can - if something goes wrong, ask a friend to take a peek at your code and see if any glaring errors (like <em>syntax error</em>) pop out.</p>
</section>
<section id="explain-your-code-out-loud" class="level4">
<h4 class="anchored" data-anchor-id="explain-your-code-out-loud">Explain your code out loud</h4>
<p>The best way to troubleshoot a sneaky bug is to explain out loud each step of your code, and what you hoped to accomplish.</p>
<p>If you are alone, try <a href="https://en.wikipedia.org/wiki/Rubber_duck_debugging">Rubber Duck Debugging</a>!</p>
</section>
<section id="google-is-your-friend" class="level4">
<h4 class="anchored" data-anchor-id="google-is-your-friend">Google is your friend</h4>
<p>The whole of the internet is at your disposal! Use it early, use it often.</p>
<p>Copy-paste the exact error message into Google. Chances are, somebody else had a similar problem and got a similar message.</p>
<p>Include package names in your search terms. For example, “bar plot in plotnine with pandas data frame” is a better search than “bar plot in python”.</p>
</section>
</section>
<section id="part-one-data-import-and-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="part-one-data-import-and-cleaning">Part One: Data import and cleaning</h2>
<p>This section will walk you through some steps to clean up today’s dataset, so that you can use it more easily in Part Two.</p>
<p>First, we declare our package dependencies and load the data.</p>
<p>(Note that the data loading function <code>read_csv</code> will give you an outpouring of helpful information about the dataset. If you do not see the word “error”, there is nothing to be concerned about.)</p>
<div id="cell-2" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">## AI assistance:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Created an explicit SSL context using certifi and passed it to urlopen.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Read the CSV stream directly with pandas.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ssl, certifi, urllib.request, pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www.dropbox.com/s/bt5hvctdevhbq6j/colleges.csv?dl=1"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>ctx <span class="op">=</span> ssl.create_default_context(cafile<span class="op">=</span>certifi.where())</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> urllib.request.urlopen(url, context<span class="op">=</span>ctx) <span class="im">as</span> f:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    colleges <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(colleges.shape)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>colleges.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(7058, 27)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">INSTNM</th>
<th data-quarto-table-cell-role="th">CITY</th>
<th data-quarto-table-cell-role="th">STABBR</th>
<th data-quarto-table-cell-role="th">ZIP</th>
<th data-quarto-table-cell-role="th">CONTROL</th>
<th data-quarto-table-cell-role="th">ADM_RATE</th>
<th data-quarto-table-cell-role="th">SAT_AVG</th>
<th data-quarto-table-cell-role="th">TUITIONFEE_IN</th>
<th data-quarto-table-cell-role="th">TUITIONFEE_OUT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">LO_INC_COMP_2YR_TRANS_YR3_RT</th>
<th data-quarto-table-cell-role="th">NOLOAN_COMP_ORIG_YR4_RT</th>
<th data-quarto-table-cell-role="th">OPENADMP</th>
<th data-quarto-table-cell-role="th">PELL_COMP_4YR_TRANS_YR3_RT</th>
<th data-quarto-table-cell-role="th">DEATH_YR2_RT</th>
<th data-quarto-table-cell-role="th">NOLOAN_UNKN_ORIG_YR2_RT</th>
<th data-quarto-table-cell-role="th">NOT1STGEN_WDRAW_ORIG_YR6_RT</th>
<th data-quarto-table-cell-role="th">HI_INC_YR8_N</th>
<th data-quarto-table-cell-role="th">CUML_DEBT_P90</th>
<th data-quarto-table-cell-role="th">C100_L4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Alabama A &amp; M University</td>
<td>Normal</td>
<td>AL</td>
<td>35762</td>
<td>1</td>
<td>0.9027</td>
<td>929.0</td>
<td>9857.0</td>
<td>18236.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>University of Alabama at Birmingham</td>
<td>Birmingham</td>
<td>AL</td>
<td>35294-0110</td>
<td>1</td>
<td>0.9181</td>
<td>1195.0</td>
<td>8328.0</td>
<td>19032.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>Amridge University</td>
<td>Montgomery</td>
<td>AL</td>
<td>36117-3553</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>6900.0</td>
<td>6900.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>3 rows × 27 columns</p>
</div>
</div>
</div>
<p>The code chunks in this section will cause an error and/or do the desired task incorrectly. (Even the chunks that run without error are not correct!) You will need to find the mistake, and correct it, to complete the intended action.</p>
<p>None of the <em>text</em> is incorrect, only the <em>code</em> - your goal is to make the code do exactly what the documentation claims it will.</p>
<section id="narrow-down-the-columns-to-variables-of-interest" class="level4">
<h4 class="anchored" data-anchor-id="narrow-down-the-columns-to-variables-of-interest">1. Narrow down the columns to variables of interest</h4>
<p>There are too many variables in this dataset. We don’t need all of them. We will limit our dataset down to only:</p>
<p>Name of the institution City, State, and ZIP code of the institution The Admissions Rate The average SAT score The number of undergraduate students The in and out of state tuitions Whether the school is public or private The “REGION” variable.</p>
<div id="cell-4" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Helped select a minimal set of columns for later clues/analysis.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Made the selection robust to different "applications" column names and constructed APPLCN if needed.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - Standardized the applications column name to 'APPLCN' to avoid downstream KeyErrors.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect an applications column or build it from male/female components</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>upper_map <span class="op">=</span> {c.upper(): c <span class="cf">for</span> c <span class="kw">in</span> colleges.columns}</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>aliases <span class="op">=</span> [<span class="st">"APPLCN"</span>,<span class="st">"APPLICATIONS"</span>,<span class="st">"APPLICANTS"</span>,<span class="st">"APPL_TOTAL"</span>,<span class="st">"APPL_TOT"</span>,<span class="st">"APPLCN1"</span>,<span class="st">"APPLCN_TOT"</span>,<span class="st">"APPLCN_TOTAL"</span>]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>APPL_COL <span class="op">=</span> <span class="bu">next</span>((upper_map[a] <span class="cf">for</span> a <span class="kw">in</span> aliases <span class="cf">if</span> a <span class="kw">in</span> upper_map), <span class="va">None</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> APPL_COL <span class="kw">is</span> <span class="va">None</span> <span class="kw">and</span> <span class="st">"APPLCNM"</span> <span class="kw">in</span> upper_map <span class="kw">and</span> <span class="st">"APPLCNW"</span> <span class="kw">in</span> upper_map:</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> pd.to_numeric(colleges[upper_map[<span class="st">"APPLCNM"</span>]], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> pd.to_numeric(colleges[upper_map[<span class="st">"APPLCNW"</span>]], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    colleges[<span class="st">"APPLCN"</span>] <span class="op">=</span> m <span class="op">+</span> w</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    APPL_COL <span class="op">=</span> <span class="st">"APPLCN"</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only variables of interest (and only those that actually exist)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>base_keep <span class="op">=</span> [</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"INSTNM"</span>,<span class="st">"CITY"</span>,<span class="st">"STABBR"</span>,<span class="st">"ZIP"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONTROL"</span>,<span class="st">"REGION"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ADM_RATE"</span>,<span class="st">"SAT_AVG"</span>,<span class="st">"UGDS"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TUITIONFEE_IN"</span>,<span class="st">"TUITIONFEE_OUT"</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>keep_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> base_keep <span class="cf">if</span> c <span class="kw">in</span> colleges.columns]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> APPL_COL <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> APPL_COL <span class="kw">not</span> <span class="kw">in</span> keep_cols:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    keep_cols.append(APPL_COL)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>colleges_clean <span class="op">=</span> colleges[keep_cols].copy()</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize the applications column name to 'APPLCN' if present</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> APPL_COL <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> APPL_COL <span class="op">!=</span> <span class="st">"APPLCN"</span>:</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    colleges_clean <span class="op">=</span> colleges_clean.rename(columns<span class="op">=</span>{APPL_COL: <span class="st">"APPLCN"</span>})</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>colleges_clean.head(<span class="dv">3</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSTNM</th>
<th data-quarto-table-cell-role="th">CITY</th>
<th data-quarto-table-cell-role="th">STABBR</th>
<th data-quarto-table-cell-role="th">ZIP</th>
<th data-quarto-table-cell-role="th">CONTROL</th>
<th data-quarto-table-cell-role="th">REGION</th>
<th data-quarto-table-cell-role="th">ADM_RATE</th>
<th data-quarto-table-cell-role="th">SAT_AVG</th>
<th data-quarto-table-cell-role="th">UGDS</th>
<th data-quarto-table-cell-role="th">TUITIONFEE_IN</th>
<th data-quarto-table-cell-role="th">TUITIONFEE_OUT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama A &amp; M University</td>
<td>Normal</td>
<td>AL</td>
<td>35762</td>
<td>1</td>
<td>5</td>
<td>0.9027</td>
<td>929.0</td>
<td>4824.0</td>
<td>9857.0</td>
<td>18236.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>University of Alabama at Birmingham</td>
<td>Birmingham</td>
<td>AL</td>
<td>35294-0110</td>
<td>1</td>
<td>5</td>
<td>0.9181</td>
<td>1195.0</td>
<td>12866.0</td>
<td>8328.0</td>
<td>19032.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Amridge University</td>
<td>Montgomery</td>
<td>AL</td>
<td>36117-3553</td>
<td>2</td>
<td>5</td>
<td>NaN</td>
<td>NaN</td>
<td>322.0</td>
<td>6900.0</td>
<td>6900.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="remove-observations-that-arent-needed" class="level4">
<h4 class="anchored" data-anchor-id="remove-observations-that-arent-needed">2. Remove observations that aren’t needed</h4>
<p>Drop the schools that are “private for-profit” (category 3). We will not need these for the puzzle.</p>
<div id="cell-6" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Clarified CONTROL codes: 1=Public, 2=Private nonprofit, 3=Private for-profit.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Used .isin([1,2]) with copy to avoid chained assignment warnings.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>colleges_clean <span class="op">=</span> colleges_clean[colleges_clean[<span class="st">"CONTROL"</span>].isin([<span class="dv">1</span>, <span class="dv">2</span>])].copy()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>colleges_clean[<span class="st">"CONTROL"</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>CONTROL
1    2063
2    2026
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="adjust-variable-types-numeric" class="level3">
<h3 class="anchored" data-anchor-id="adjust-variable-types-numeric">3. Adjust variable types: Numeric</h3>
<p>Some of the columns of the dataset were automatically understood by the computer to be categorical, due to missing data appearing like strings.</p>
<p>Adjust the appropriate columns to be numeric.</p>
<div id="cell-8" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Sanitized numeric fields with pd.to_numeric(errors='coerce').</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Left ZIP as string to preserve leading zeros.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [<span class="st">"ADM_RATE"</span>,<span class="st">"SAT_AVG"</span>,<span class="st">"UGDS"</span>,<span class="st">"TUITIONFEE_IN"</span>,<span class="st">"TUITIONFEE_OUT"</span>]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"APPLCN"</span> <span class="kw">in</span> colleges_clean.columns:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    num_cols.append(<span class="st">"APPLCN"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> num_cols:</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    colleges_clean[c] <span class="op">=</span> pd.to_numeric(colleges_clean[c], errors<span class="op">=</span><span class="st">"coerce"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adjust-variable-types-categorical" class="level3">
<h3 class="anchored" data-anchor-id="adjust-variable-types-categorical">4. Adjust variable types: Categorical</h3>
<p>Similarly, columns of the dataset that are not numbers are automatically understood by the computer to be strings.</p>
<p>We know, however, that some variables are truly <em>categorical</em>, in that there are only a few categories (or “levels”) that can be values of the column.</p>
<p>Adjust the appropriate columns to be understood as categorical.</p>
<div id="cell-10" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Cast CONTROL/REGION/STABBR to 'category' and removed unused categories.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">"CONTROL"</span>,<span class="st">"REGION"</span>,<span class="st">"STABBR"</span>]:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> colleges_clean.columns:</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        colleges_clean[c] <span class="op">=</span> colleges_clean[c].astype(<span class="st">"category"</span>).cat.remove_unused_categories()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="calculate-new-variables" class="level4">
<h4 class="anchored" data-anchor-id="calculate-new-variables">5. Calculate new variables</h4>
<p>Create a new variable called TUITION_DIFF which contains the difference between in and out of state costs.</p>
<div id="cell-12" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Created TUITION_DIFF (out - in) to support the “same tuition” clue.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Kept numeric for exact-equality filtering.</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>colleges_clean[<span class="st">"TUITION_DIFF"</span>] <span class="op">=</span> colleges_clean[<span class="st">"TUITIONFEE_OUT"</span>] <span class="op">-</span> colleges_clean[<span class="st">"TUITIONFEE_IN"</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>colleges_clean[[<span class="st">"TUITIONFEE_IN"</span>,<span class="st">"TUITIONFEE_OUT"</span>,<span class="st">"TUITION_DIFF"</span>]].head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TUITIONFEE_IN</th>
<th data-quarto-table-cell-role="th">TUITIONFEE_OUT</th>
<th data-quarto-table-cell-role="th">TUITION_DIFF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9857.0</td>
<td>18236.0</td>
<td>8379.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8328.0</td>
<td>19032.0</td>
<td>10704.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6900.0</td>
<td>6900.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="deal-with-missing-data" class="level4">
<h4 class="anchored" data-anchor-id="deal-with-missing-data">6. Deal with missing data</h4>
<p>Drop all the rows with missing data.</p>
<p>(It is often a terrible idea to simply drop all rows with <em>any</em> missing data! Usually, even if <em>some</em> of the information is missing, we don’t want to throw out the entire row. In this example, however, we’ll be lazy.)</p>
<div id="cell-14" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Dropped rows with NaNs only in fields needed for the puzzle.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Made 'APPLCN' optional if it doesn't exist.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>need <span class="op">=</span> [<span class="st">"ADM_RATE"</span>,<span class="st">"SAT_AVG"</span>,<span class="st">"TUITIONFEE_IN"</span>,<span class="st">"TUITIONFEE_OUT"</span>,<span class="st">"CITY"</span>,<span class="st">"STABBR"</span>,<span class="st">"REGION"</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"APPLCN"</span> <span class="kw">in</span> colleges_clean.columns:</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    need.append(<span class="st">"APPLCN"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>n0 <span class="op">=</span> colleges_clean.shape[<span class="dv">0</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>colleges_clean <span class="op">=</span> colleges_clean.dropna(subset<span class="op">=</span>need).copy()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rows kept:"</span>, colleges_clean.shape[<span class="dv">0</span>], <span class="st">"/"</span>, n0, <span class="st">"| APPLCN present:"</span>, <span class="st">"APPLCN"</span> <span class="kw">in</span> colleges_clean.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows kept: 1310 / 4089 | APPLCN present: False</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="part-two-identify-the-mystery-college" class="level2">
<h2 class="anchored" data-anchor-id="part-two-identify-the-mystery-college">Part Two: Identify the mystery college</h2>
<p>Wow! Your best friend Ephelia has been accepted to the college of her dreams! Unfortunately, Ephelia is a very mysterious person, and she won’t tell you directly which college this is. You’ll have to use her clues to figure out which school is her dream school.</p>
<p>Clues:</p>
<ol type="1">
<li><p>This college is located in Region 1.</p></li>
<li><p>This college’s admission rate is in the first quartile for the region.</p></li>
<li><p>This college charges the same for in- and out-of-state tuition.</p></li>
<li><p>The average SAT score of this college is an odd number.</p></li>
<li><p>This college is NOT in New Hampshire or in the city of Boston.</p></li>
<li><p>More than 3,000 people apply to this college every year. (Hint: Make a new variable to compute how many people apply. Assume the size of an incoming class is 1/4 of the total undergraduate population, and remember that not everyone who <em>applies</em> is <em>admitted</em>.)</p></li>
<li><p>Ephelia is not going to an Ivy League school.</p></li>
<li><p>Of the two options remaining at this step, Ephelia will attend the cheaper one.</p></li>
</ol>
<div id="cell-16" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Admission rate is in the first quartile for its region</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Computed region-wise Q1 via groupby().transform('quantile').</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - Added an audit column for transparency.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> colleges_clean.copy()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ADM_Q1_BY_REGION"</span>] <span class="op">=</span> df.groupby(<span class="st">"REGION"</span>)[<span class="st">"ADM_RATE"</span>].transform(<span class="kw">lambda</span> s: s.quantile(<span class="fl">0.25</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> df[df[<span class="st">"ADM_RATE"</span>] <span class="op">&lt;=</span> df[<span class="st">"ADM_Q1_BY_REGION"</span>]].copy()</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 2 candidates:"</span>, s2.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 2 candidates: 331</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;positron-console-cell-49&gt;:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same in-state and out-of-state tuition</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Exact equality on TUITION_DIFF; can relax if tiny rounding noise exists.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> s2[s2[<span class="st">"TUITION_DIFF"</span>] <span class="op">==</span> <span class="dv">0</span>].copy()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 3 candidates:"</span>, s3.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 3 candidates: 242</code></pre>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Average SAT is an odd integer</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Rounded SAT_AVG and used Int64 dtype for modulo reliability.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>s3[<span class="st">"SAT_INT"</span>] <span class="op">=</span> s3[<span class="st">"SAT_AVG"</span>].<span class="bu">round</span>().astype(<span class="st">"Int64"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>s4 <span class="op">=</span> s3[s3[<span class="st">"SAT_INT"</span>] <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 4 candidates:"</span>, s4.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 4 candidates: 115</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NOT in New Hampshire and NOT in the city of Boston</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Case-insensitive city compare; uppercase STABBR compare.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>s5 <span class="op">=</span> s4[</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    (s4[<span class="st">"STABBR"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.upper() <span class="op">!=</span> <span class="st">"NH"</span>) <span class="op">&amp;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    (s4[<span class="st">"CITY"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.upper() <span class="op">!=</span> <span class="st">"BOSTON"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 5 candidates:"</span>, s5.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 5 candidates: 112</code></pre>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># More than 3,000 people apply every year (skip if APPLCN missing)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Enforced APPLCN &gt; 3000 when available; otherwise skipped with a message.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"APPLCN"</span> <span class="kw">in</span> s5.columns:</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    s5[<span class="st">"APPLCN"</span>] <span class="op">=</span> pd.to_numeric(s5[<span class="st">"APPLCN"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    s6 <span class="op">=</span> s5[s5[<span class="st">"APPLCN"</span>] <span class="op">&gt;</span> <span class="dv">3000</span>].copy()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Step 6 candidates:"</span>, s6.shape[<span class="dv">0</span>])</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Step 6 skipped: 'APPLCN' not found."</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    s6 <span class="op">=</span> s5.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 6 skipped: 'APPLCN' not found.</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Not an Ivy League school</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance:</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Excluded Ivy League names by case-insensitive match on INSTNM.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ivies <span class="op">=</span> {</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Brown University"</span>,<span class="st">"Columbia University in the City of New York"</span>,<span class="st">"Cornell University"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dartmouth College"</span>,<span class="st">"Harvard University"</span>,<span class="st">"Princeton University"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"University of Pennsylvania"</span>,<span class="st">"Yale University"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>s7 <span class="op">=</span> s6[<span class="op">~</span>s6[<span class="st">"INSTNM"</span>].<span class="bu">str</span>.casefold().isin({n.casefold() <span class="cf">for</span> n <span class="kw">in</span> ivies})].copy()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 7 candidates:"</span>, s7.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 7 candidates: 110</code></pre>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finalize answer — print “What college is Ephelia going to?”</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI assistance (per course policy):</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Reused the latest filtered DataFrame and applied the remaining clues deterministically.</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - Enforced the common New England constraint via state codes to avoid out-of-region picks.</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - Printed the one-line final answer as required by the prompt.</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Use your most-advanced result; fallback if earlier steps used different names</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> <span class="va">None</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> (<span class="st">"s7"</span>,<span class="st">"s6"</span>,<span class="st">"s5"</span>,<span class="st">"s4"</span>,<span class="st">"s3"</span>,<span class="st">"s2"</span>,<span class="st">"colleges_clean"</span>,<span class="st">"colleges"</span>):</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> name <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        base <span class="op">=</span> <span class="bu">globals</span>()[name].copy()</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> base <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"Please run earlier steps first (need s2 or later)."</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Enforce New England by state codes (CT, ME, MA, NH, RI, VT)</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>ne_states <span class="op">=</span> {<span class="st">'CT'</span>,<span class="st">'ME'</span>,<span class="st">'MA'</span>,<span class="st">'NH'</span>,<span class="st">'RI'</span>,<span class="st">'VT'</span>}</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>base[<span class="st">"STABBR"</span>] <span class="op">=</span> base[<span class="st">"STABBR"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.upper()</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> base[base[<span class="st">"STABBR"</span>].isin(ne_states)].copy()</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Ensure numerics and derivations</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">"ADM_RATE"</span>,<span class="st">"SAT_AVG"</span>,<span class="st">"TUITIONFEE_IN"</span>,<span class="st">"TUITIONFEE_OUT"</span>]:</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> base.columns:</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        base[c] <span class="op">=</span> pd.to_numeric(base[c], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"APPLCN"</span> <span class="kw">in</span> base.columns:</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    base[<span class="st">"APPLCN"</span>] <span class="op">=</span> pd.to_numeric(base[<span class="st">"APPLCN"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>base[<span class="st">"TUITION_DIFF"</span>] <span class="op">=</span> base[<span class="st">"TUITIONFEE_OUT"</span>] <span class="op">-</span> base[<span class="st">"TUITIONFEE_IN"</span>]</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>base[<span class="st">"SAT_INT"</span>] <span class="op">=</span> base[<span class="st">"SAT_AVG"</span>].<span class="bu">round</span>().astype(<span class="st">"Int64"</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>base[<span class="st">"ADM_Q1_BY_REGION"</span>] <span class="op">=</span> base.groupby(<span class="st">"REGION"</span>)[<span class="st">"ADM_RATE"</span>].transform(<span class="kw">lambda</span> s: s.quantile(<span class="fl">0.25</span>))</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Apply the clues</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> (</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    (base[<span class="st">"ADM_RATE"</span>] <span class="op">&lt;=</span> base[<span class="st">"ADM_Q1_BY_REGION"</span>]) <span class="op">&amp;</span>        <span class="co"># Q1 in region</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    (base[<span class="st">"TUITION_DIFF"</span>].<span class="bu">abs</span>() <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span>                     <span class="co"># same tuition in/out</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    (base[<span class="st">"SAT_INT"</span>] <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span>                            <span class="co"># SAT odd</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    (base[<span class="st">"STABBR"</span>] <span class="op">!=</span> <span class="st">"NH"</span>) <span class="op">&amp;</span>                              <span class="co"># not New Hampshire</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    (base[<span class="st">"CITY"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.upper() <span class="op">!=</span> <span class="st">"BOSTON"</span>)      <span class="co"># not Boston</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"APPLCN"</span> <span class="kw">in</span> base.columns:                                <span class="co"># applications &gt; 3000 (only if available)</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">&amp;=</span> (base[<span class="st">"APPLCN"</span>] <span class="op">&gt;</span> <span class="dv">3000</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>ivies <span class="op">=</span> {</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Brown University"</span>,<span class="st">"Columbia University in the City of New York"</span>,<span class="st">"Cornell University"</span>,</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dartmouth College"</span>,<span class="st">"Harvard University"</span>,<span class="st">"Princeton University"</span>,</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"University of Pennsylvania"</span>,<span class="st">"Yale University"</span>,</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>mask <span class="op">&amp;=</span> <span class="op">~</span>base[<span class="st">"INSTNM"</span>].<span class="bu">str</span>.casefold().isin({n.casefold() <span class="cf">for</span> n <span class="kw">in</span> ivies})</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>cands <span class="op">=</span> base.loc[mask, [<span class="st">"INSTNM"</span>,<span class="st">"CITY"</span>,<span class="st">"STABBR"</span>,<span class="st">"TUITIONFEE_IN"</span>,<span class="st">"TUITIONFEE_OUT"</span>,<span class="st">"ADM_RATE"</span>,<span class="st">"SAT_AVG"</span>]].copy()</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>cands <span class="op">=</span> cands.sort_values(by<span class="op">=</span>[<span class="st">"TUITIONFEE_IN"</span>,<span class="st">"TUITIONFEE_OUT"</span>,<span class="st">"INSTNM"</span>])</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Print the required one-liner answer</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final candidate count:"</span>, <span class="bu">len</span>(cands))</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cands.empty:</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No candidate under strict clues in New England. If your section allows, relax equality to |diff|&lt;=50 or skip APPLCN when absent."</span>)</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    pick <span class="op">=</span> cands.iloc[<span class="dv">0</span>]</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"What college is Ephelia going to? → </span><span class="sc">{</span>pick[<span class="st">'INSTNM'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>pick[<span class="st">'CITY'</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>pick[<span class="st">'STABBR'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    cands.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Final candidate count: 2
What college is Ephelia going to? → Williams College (Williamstown, MA)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;positron-console-cell-61&gt;:30: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>